---
title: "Markdownã¨Goè¨€èªã ã‘ã§Webã‚¢ãƒ—ãƒªä½œã£ã¦ã¿ãŸ"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["go", "markdown"]
published: true
---

goã ã‘ã§ã‚¢ãƒ—ãƒªã¤ãã‚ŠãŸã„ãªãƒ¼ã¨æ€ã„ã€HTMLã‚„CSSã‚’ä½¿ã‚ãšã«Webã‚¢ãƒ—ãƒªã‚’ã¤ãã‚Œãªã„ã‹è©¦ã—ã¦ã¿ã¾ã—ãŸï¼
è‡ªç”±åº¦ã‚„ãƒ‡ã‚¶ã‚¤ãƒ³ãªã©ã‚ã‚‹ç¨‹åº¦åˆ¶é™ãŒã‚ã‚Šã¾ã™ãŒã€ä»®ã‚¢ãƒ—ãƒªã¨ã—ã¦ã¯ã»ã©ã»ã©ã«ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã¯ãªã£ãŸã¨æ€ã„ã¾ã™ã€‚

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯[ã“ã¡ã‚‰   (HikaruEgashira/simple-server - GitHub)](https://github.com/HikaruEgashira/simple-server)

- `http://localhost:8080/user?name=engineer`ã®ãƒšãƒ¼ã‚¸
[![Image from Gyazo](https://i.gyazo.com/9aceee8a093b4e936a85d2feb315f540.png)](https://gyazo.com/9aceee8a093b4e936a85d2feb315f540)

## ä»Šå›ã‚„ã‚‹å†…å®¹

- HTMLéƒ¨åˆ†ã‚’Markdownã«ç½®ãæ›ãˆãŸWebã‚¢ãƒ—ãƒªã®ä½œæˆ
- ãƒ•ã‚©ãƒ¼ãƒ ã«åå‰ã‚’å…¥åŠ›ã—ãŸã‚‰ã€userãƒšãƒ¼ã‚¸ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è¡¨ç¤ºã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ—ãƒª
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦ginã‚’ç”¨ã„ã¾ã™ã€‚å¤šåˆ†ä¸€ç•ªæœ‰åãªã®ã§

[gin-gonic/gin - GitHub](https://github.com/gin-gonic/gin)

## æ–¹é‡

1. Markdownã‚’HTML(æ­£å¼ã«ã¯mustache HTML)ã«å¤‰æ›
2. mustache HTMLã‹ã‚‰è¡¨ç¤ºã™ã‚‹HTMLã‚’ç”Ÿæˆ
3. æç”»

æ™®é€šã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨æ¯”è¼ƒã™ã‚‹ã¨
æ‰‹é †1ãŒå¢—ãˆãŸã ã‘ãªã®ã§ã€ã‚„ã‚Šæ–¹ã•ãˆã¤ã‹ã‚ã°ã„ã‚ã„ã‚ãªå¿œç”¨ãŒã§ãã¾ã™ã€‚

## åˆæœŸæ§‹ç¯‰

Go moduleã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```bash
go mod init github.com/xxxxx/yyyyy
go get -u github.com/gin-gonic/gin # Goãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
go get -u github.com/russross/blackfriday # Markdownã‚’HTMLã«å¤‰æ›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
go get -u github.com/cbroglie/mustache # Markdownã§å¤‰æ•°ã‚’å…¥ã‚Œã‚‹ã®ã«ä½¿ã†
```

éšå±¤æ§‹é€ ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

- controller ... ãƒšãƒ¼ã‚¸ã”ã¨ã®å‡¦ç†ã‚’è¡Œã†
- lib ... Markdownã‹ã‚‰HTMLã‚’ç”Ÿæˆã—æç”»ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆ
- pages ... æç”»ã™ã‚‹Markdown
- template ... htmlãŒæ›¸ã„ã¦ã‚ã‚‹ã‘ã©ã€ã‚³ãƒ”ãƒšã§å¤§ä¸ˆå¤«
- usecase ... ãƒ­ã‚¸ãƒƒã‚¯ç½®ãå ´

```bash
simple-server â¯â¯â¯ tree .
.
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ main.go
â”œâ”€â”€ controller
â”‚   â”œâ”€â”€ index.go
â”‚   â””â”€â”€ user.go
â”œâ”€â”€ lib
â”‚   â””â”€â”€ lib.go
â”œâ”€â”€ pages
â”‚   â”œâ”€â”€ index.md
â”‚   â””â”€â”€ user.md
â”œâ”€â”€ template
â”‚   â””â”€â”€ md.html
â””â”€â”€ usecase
    â””â”€â”€ hello.go
```

## Markdownã‚’GitHubã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«ã™ã‚‹ãŸã‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ä½œæˆ

ã‚³ãƒ”ãƒšã§å‹•ãã¾ã™ã€‚
github-markdown-cssã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç”¨ã„ã¦CSSã‚’è§¦ã‚‰ãšã«è¦‹ãŸç›®ã‚’æ•´ãˆã¦ã„ã¾ã™ã€‚

```html
{{define "md"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Markdown Server</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css" integrity="sha512-Oy18vBnbSJkXTndr2n6lDMO5NN31UljR8e/ICzVPrGpSud4Gkckb8yUpqhKuUNoE+o9gAb4O/rAxxw1ojyUVzg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
        }
    
        @media (max-width: 767px) {
            .markdown-body {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="markdown-body">        
        {{.}}
    </div>
</body>
</html>
{{end}}
```

## Markdownã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆ

ãƒ•ã‚©ãƒ¼ãƒ ã«ã ã‘HTMLã‚’ä½¿ã„ã¾ã™ã®ã§ã“ã“ã ã‘èª¿ã¹ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚

```md
<!-- pages/index.md -->
# simple-server

### åå‰ã‚’å…¥åŠ›

<form
  action="user"
  method="GET"
>
  <input type="text" name="name" placeholder="type username">
  <input type="submit" value="go">
</form>
```

å€¤ã‚’åŸ‹ã‚è¾¼ã‚€ã¨ãã¯mustacheå½¢å¼ã§æ›¸ãã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
`{{ }}`ã®ä¸­ã«å¤‰æ•°åã‚’æ›¸ãã ã‘ã§ã™ã€‚

```md
<!-- pages/user.md -->
# Welcome

{{ text }}

[home](/)
```

## Markdownã‚’HTMLã«å¤‰æ›ã™ã‚‹Renderé–¢æ•°ã®ä½œæˆ

ç¬¬äºŒå¼•æ•°ã«ãƒ‘ã‚¹ã€‚ãã‚Œä»¥é™ã®å¼•æ•°ã§Markdownä¸Šã«åŸ‹ã‚è¾¼ã¿ãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```go
// lib/lib.go
package lib

import (
	"html/template"
	"io"
	"io/ioutil"

	"github.com/cbroglie/mustache"
	"github.com/russross/blackfriday"
)

func Render(w io.Writer, path string, context ...interface{}) {
    md, _ := ioutil.ReadFile(path + ".md")

    // 1. Markdownã‚’HTML(æ­£å¼ã«ã¯mustache HTML)ã«å¤‰æ›
	mustacheHtml := string(blackfriday.Run(md))
    // 2. mustache HTMLã‹ã‚‰è¡¨ç¤ºã™ã‚‹HTMLã‚’ç”Ÿæˆ
	html, _ := mustache.Render(mustacheHtml, context...)

    // 3. æç”»
	tmpl := template.Must(template.ParseFiles("template/md.html"))
	tmpl.ExecuteTemplate(w, "md", template.HTML(html))
}
```

```go
// ä½¿ã„æ–¹
// pages/userã«textãŒåŸ‹ã‚è¾¼ã¾ã‚ŒãŸHTMLã‚’è¿”ã™
lib.Render(c.Writer, "pages/user", map[string]string{"text": text})
```

## ginã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

mainé–¢æ•°ã§ã¯ginã‚’åˆ©ç”¨ã—ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚
ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ã€‚

```go
// main.go
package main

import (
	"github.com/xxxxx/yyyyy/controller"
	"github.com/gin-gonic/gin"
)

func main() {
	router := gin.Default()
	router.GET("/", controller.IndexHandler)
	router.GET("/user", controller.UserHandler)
	router.Run(":8080")
}
```

## Controllerã®ä½œæˆ

é™çš„ãªãƒšãƒ¼ã‚¸ã‚’è¿”ã™ã ã‘ãªã‚‰ä¸€è¡Œã§ãŠã£ã‘ãƒ¼

```go
// controller/index.go
package controller

import (
	"github.com/xxxxx/yyyyy/lib"
	"github.com/gin-gonic/gin"
)

func IndexHandler(c *gin.Context) {
	lib.Render(c.Writer, "pages/index")
}
```

å€¤ã‚’åŸ‹ã‚è¾¼ã‚€ã¨ãã¯ã€å¼•æ•°ã«æ¸¡ã—ã¦ã‚ã’ã¾ã™ã€‚

```go
// controller/user.go
package controller

import (
	"github.com/xxxxx/yyyyy/lib"
	"github.com/xxxxx/yyyyy/usecase"
	"github.com/gin-gonic/gin"
)

func UserHandler(c *gin.Context) {
	name := c.Query("name")

	text := usecase.Hello(name)

	lib.Render(c.Writer, "pages/user", map[string]string{"text": text})
}
```

ã“ã‚“ãªæ„Ÿã˜ã«HTMLã‚’ä½¿ã‚ãšã«ç”»é¢éƒ¨åˆ†ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼

[![Image from Gyazo](https://i.gyazo.com/9aceee8a093b4e936a85d2feb315f540.png)](https://gyazo.com/9aceee8a093b4e936a85d2feb315f540)

## ã¾ã¨ã‚

æœ¬æ ¼çš„ãªã‚¢ãƒ—ãƒªã«ãªã‚‹ã¨ã“ã‚Œã ã‘ã ã¨é›£ã—ã„ã®ã§ã™ãŒã€ã¾ãšã¯ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚’ã¤ãã‚‹ã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ï¼
å®Ÿéš›ã«ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã ã‘ã®ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‹ã‚‰ã‚¢ãƒ—ãƒªåŒ–ã¾ã§ã‚‚ã£ã¦ã„ã£ãŸå®Ÿä¾‹ï¼ˆè‡ªåˆ†ï¼‰ãŒã‚ã‚‹ã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚

[Twin:teã®æ­´å² - hatenablog](https://twinte.hatenablog.com/entry/2020/05/20/220846)
